version: '3.8'
services:
  # ... (Tu servicio minecraft_server) ...
  
  # ----------------------------------------------------
  # SERVICIO 2: PLAYIT.GG TUNNEL (CONFIGURACIÓN ESTABLE)
  # ----------------------------------------------------
  playit_agent:
    image: playit-agent-build:latest
    container_name: playit_minecraft_tunnel
    restart: unless-stopped
    
    # CRÍTICO: Usamos el build local que ahora tiene el binario pre-descargado
    build:
      context: .
      dockerfile: playit.dockerfile # Usa el Dockerfile con la descarga en el build
    
    # DNS fix (se mantiene como buena práctica, aunque la descarga ya no lo necesita)
    dns:
      - 8.8.8.8
      - 1.1.1.1
    
    # Esenciales para obtener el código de claim
    stdin_open: true
    tty: true
    
    networks:
      - minecraft_tunnel_network
      
    # Volumen que mapea a /app (donde playit guarda la config: /app/.playit)
    volumes:
      - playit_config_data:/app

# ----------------------------------------------------
# DEFINICIÓN DE VOLÚMENES Y REDES (al final del archivo)
# ----------------------------------------------------
volumes:
  minecraft_data:
    name: ${WORLD_VOLUME_NAME:-mc-world-data}
    driver: local
  # CRÍTICO: Nuevo volumen para persistir la configuración de playit (token y túneles)
  playit_config_data:
    name: ${PLAYIT_VOLUME_NAME:-playit-config}
    driver: local

networks:
  minecraft_tunnel_network:
    name: minecraft_tunnel_network
    driver: bridge
